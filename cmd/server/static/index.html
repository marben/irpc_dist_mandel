<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<title>Go WASM + irpc + WebSocket</title>
</head>

<body>
	<header>Go WASM · irpc · Distributed Mandelbrot</header>

	<main>
		<div class="canvas-wrap">
			<div id="hud">
				<div><strong>Tiles</strong> <span id="tilesDone">0</span>/<span id="tilesTotal">0</span></div>
				<div><strong>Workers</strong> <span id="workersRunning">0</span></div>
			</div>
			<canvas id="myCanvas" width="1920" height="1080"></canvas>
		</div>

		<div class="log-panel">
			<div class="log-header">Logs</div>
			<pre id="log"></pre>
		</div>
	</main>

	<!--
		wasm_exec.js is part of golang distribution and is necessary for the actual wasm code to work
	 	It can differ for different versions of golang compiler,
		so when experimenting make sure to use matching version of wasm_exec.js
	-->
	<script src="wasm_exec.js"></script>

	<script>
		const go = new Go();
		WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject)
			.then(result => go.run(result.instance));
	</script>

	<!-- Follows just the styling -->
	<style>
		:root {
			--bg: #0f0f13;
			--panel: #181820;
			--text: #e6e6eb;
			--muted: #9aa0a6;
			--accent: #7dd3fc;
			--log-bg: #0b0b10;
		}

		* {
			box-sizing: border-box;
		}

		body {
			margin: 0;
			height: 100vh;
			display: flex;
			flex-direction: column;
			font-family: system-ui, sans-serif;
			background: var(--bg);
			color: var(--text);
		}

		header {
			padding: 0.75rem 1rem;
			background: var(--panel);
			border-bottom: 1px solid #222;
			font-weight: 600;
			color: var(--accent);
		}

		main {
			flex: 1;
			display: grid;
			grid-template-columns: 1fr 360px;
			background: #222;
		}

		/* ---------- Canvas ---------- */

		.canvas-wrap {
			display: flex;
			flex-direction: column;
			background: #181c2b;
		}

		#hud {
			display: flex;
			gap: 1.5rem;
			align-items: center;
			padding: 0.4rem 0.75rem;
			font-size: 0.8rem;
			background: var(--panel);
			border-bottom: 1px solid #222;
			color: #e5e7eb;
			box-shadow: inset 0 -1px 0 rgba(255,255,255,0.05);
		}

		#hud strong {
			color: var(--accent);
			font-weight: 600;
		}

		canvas {
			width: 100%;
			height: auto;
			aspect-ratio: 1920 / 1080;
			image-rendering: pixelated;
			background: #181c2b;
			border: 2px solid var(--accent);
			border-radius: 8px;
			box-shadow: 0 0 16px 2px #7dd3fc33;
		}

		/* ---------- Logs ---------- */

		.log-panel {
			display: flex;
			height: 100%;
			flex-direction: column;
			background: var(--panel);
			border-left: 1px solid #222;
		}

		.log-header {
			padding: 0.5rem 0.75rem;
			font-size: 0.85rem;
			color: var(--muted);
			border-bottom: 1px solid #222;
		}

		pre#log {
			flex: 1 1 auto;
			height: 100%;
			margin: 0;
			padding: 1.75rem;
			background: var(--log-bg);
			color: #d1d5db;
			font-size: 0.8rem;
			line-height: 1.4;
			overflow-y: auto;
			white-space: pre-wrap;
		}

		/* ---------- Mobile ---------- */

		@media (max-width: 900px) {
			main {
				grid-template-columns: 1fr;
				grid-template-rows: auto minmax(35vh, 45vh);
			}

			.log-panel {
				border-left: none;
				border-top: 1px solid #222;
			}

			pre#log {
				font-size: 0.9rem;
			}

			#hud {
				font-size: 0.85rem;
				padding: 0.5rem 0.75rem;
			}
		}
	</style>
</body>
</html>